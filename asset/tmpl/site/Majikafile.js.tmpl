/**
 * majika 設定ファイル
 */
'use strict'

const common = {
  beforeInstall: [
    'echo "registry = https://realglobe.artifactoryonline.com/realglobe/api/npm/npm-virtual" > .npmrc',
    'curl -u`sugos-secrets get -r jfrog:deployer:username`:`sugos-secrets get -r jfrog:deployer:password` "https://realglobe.artifactoryonline.com/realglobe/api/npm/auth" >> .npmrc'
  ],
  buildScript: [
    'npm install mocha istanbul babel-cli node-sass -g',
    './ci/build.js',
    'rm .npmrc'
  ],
  additionalDependencies: []
}

module.exports = {
  dockerRepositoryPrefix: 'realglobe-docker-vertual.jfrog.io/',
  dockerBuildArgs: {
    additionalOptions: ['--force-rm=true'],
    beforeInstall: common.beforeInstall,
    buildScript: common.buildScript
  },
  travisCreateArgs: {
    beforeInstall: common.beforeInstall,
    buildScript: common.buildScript
  },
  heroku: {
    preDeploy: common.beforeInstall,
    postinstall: [
      'npm run build'
    ],
    env: {
      NODE_ENV: {
        value: 'production'
      }
    },
    addons: [
      'heroku-redis:hobby-dev'
    ]
  }
}
